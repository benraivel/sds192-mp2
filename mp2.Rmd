---
title: "Mini-Project 2"
author: "Ben Raivel, Jordy Perry Greene, Ben Moss-Horwitz"
date: "2019-03-24"
output: 
  html_document:
    code_folding: hide
---


## Loading the data


##################
WHAT WE NEED TO DO
##################
-Fold code ## Done? ##
-Annotate
-Write analysis
-Write single-sentence analysis overview
-"providing context or background useful in interpreting the graphic"
-Make graph look pretty


```{r, message = FALSE}
#This is our setup block, where we initialize everything

#we first get tidyverse
library(tidyverse)

#and then load in all of our data
load("house_elections.rda")
load("candidates.rda")
load("committees.rda")
load("contributions.rda")

#finally, to help with our join, we rename the ID column in candidates to match that of house_elections
candidates <- candidates %>%
  rename("fec_id" = cand_id)
```

```{r, message = FALSE}
theFinalSet <- candidates %>%
  inner_join(house_elections, by = "fec_id") %>%
  select(fec_id, incumbent, ge_winner)


contributionPositives <- contributions %>%
  select(cand_id, transaction_amt) %>%
  filter(transaction_amt > 0) %>%
  group_by(cand_id) %>%
  summarize(totalPos = sum(transaction_amt), avgPos = mean(transaction_amt), numberPos = n()) %>%
  filter(numberPos != 0)
contributionPositives <- contributionPositives %>%
  rename("fec_id" = cand_id)

contributionNegatives <- contributions %>%
  select(cand_id, transaction_amt) %>%
  filter(transaction_amt < 0) %>%
  group_by(cand_id) %>%
  summarize(totalNeg = sum(transaction_amt), avgNeg = mean(transaction_amt), numberNeg = n())
contributionNegatives <- contributionNegatives %>%
  rename("fec_id" = cand_id)

theFinalSet <- theFinalSet %>%
  inner_join(contributionPositives, by = "fec_id")

theFinalSet <- theFinalSet %>%
  left_join(contributionNegatives, by = "fec_id")

theFinalSet[is.na(theFinalSet)] <- 0

testSet <- theFinalSet %>%
  group_by(incumbent, ge_winner) %>%
  summarise(money = mean(totalPos))

testSet %>%
  ggplot(aes(x = ge_winner, y = money, fill = ge_winner)) +
  geom_col()+
  facet_wrap("incumbent")
  
```

```{r, message = FALSE}
theFinalSet %>%
  ggplot(aes(x = totalPos, y = general_votes, color = ge_winner)) +
  geom_point(aes(alpha = 0.5)) +
  #scale_x_continuous(trans='log2') + 
  geom_smooth() +
  facet_wrap("incumbent")
```

```{r, message = FALSE}
theFinalSet %>%
  ggplot(aes(y = general_votes, x = totalPos)) +
  geom_point(aes(alpha = 0.5, color = ge_winner)) +
  scale_x_continuous(trans='log2') + 
  facet_wrap("incumbent") + 
  xlab("Total Contributions") + 
  ylab("Total Votes")
```
Github Repository Link:
https://github.com/benraivel/sds192-mp2
